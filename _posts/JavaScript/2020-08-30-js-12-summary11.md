---
title: "[JS] Javascript #11 Summary"
excerpt: 
last_modified_at: 2020-08-29

categories:
  - JavaScript

tags:
  - javascript
  - promise
  - asynchronous
  - producer
  - consumers
  - then
  - catch
  - finally

---

# Javascript \#11 Summary

> - [ë“œë¦¼ì½”ë”© by ì—˜ë¦¬](https://www.youtube.com/channel/UC_4u-bXaba7yrRz_6x6kb_w): [ìë°”ìŠ¤í¬ë¦½íŠ¸ 12. í”„ë¡œë¯¸ìŠ¤ ê°œë…ë¶€í„° í™œìš©ê¹Œì§€ JavaScript Promise | í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ì…ë¬¸í¸ (JavaScript ES6)](https://www.youtube.com/watch?v=JB_yU6Oe2eE&list=PLv2d7VI9OotTVOL4QmPfvJWPJvkmv6h-2&index=12)  
> <br><br>**Caution**<br><br>
> ê°•ì˜ë¥¼ ë“£ê³  ì œê°€ ê¸°ì–µí•˜ê¸° ì‰½ê²Œ ê¸°ë¡í•˜ì—¬ ë³€í˜•ëœ ë‚´ìš©ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> ì˜¤ë¥˜ê°€ ìˆê±°ë‚˜ í•´ë‹¹ ê¸€ì— ë¬¸ì œê°€ ìˆì„ ê²½ìš° í”¼ë“œë°± ë¶€íƒë“œë¦½ë‹ˆë‹¤.

<br>

## promise

- promise is a JavaScript object for asynchronous operation.

<br>

- when new Promise is created, the executor runs automatically.

<br>

- ì •í•´ì§„ ì¥ì‹œê°„ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³ ë‚˜ì„œ   
ì •ìƒì ìœ¼ë¡œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í–ˆë‹¤ë©´ ì„±ê³µì˜ ë©”ì„¸ì§€ì™€ í•¨ê»˜ ì²˜ë¦¬ëœ ê²°ê³¼ê°’ ì „ë‹¬ (with `resolve`),  
ë§Œì•½ ì˜ˆìƒì¹˜ ëª»í•œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤ë©´ Error ë¥¼ ì „ë‹¬ (with `reject`).  

<br>

- producer: promise object, consumers: \[`then`, `catch`, `finally`\]
  - `then` ì„ í†µí•´ ê°’ì„ ë°”ë¡œ ì „ë‹¬í•˜ê±°ë‚˜, promise object ë¥¼ ì „ë‹¬í•œë‹¤.

<br>

- **state**: pending \-\-\> fulfilled (with `then`) or rejected (with `catch`)

<br><br>

### producer vs consumers

```javascript
// 1. Producer (promise object)
const promise = new Promise((resolve, reject) => {
    // doing some heavy work (network, read files)
    console.log('doing something...');
    setTimeout(() => {
        // resolve('bruce');
        reject(new Error('no network'));
    }, 2000);
})

// 2. Consumers: then, catch, finally
promise
.then(value => {  // return promise object
    console.log(value);
})
.catch(error => {
    console.log(error);
})
.finally(() => {  // ì„±ê³µ ì‹¤íŒ¨ ìƒê´€ì—†ì´ í˜¸ì¶œ
    console.log('finally');
});
```

<br><br>

### promise chaining

```javascript
const fetchNumber = new Promise((resolve, reject) => {
    setTimeout(() => resolve(1), 1000);
})

fetchNumber
.then(num => num * 2)  // 1 * 2 = 2
.then(num => num * 3)  // 2 * 3 = 6
.then(num => {
    return new Promise((resolve, reject) => {
        setTimeout(() => resolve(num-1), 1000);
    });
})
.then(num => conosole.log(num));  // 5
```

<br><br>

### promise example

```javascript
const getHen = () => 
    new Promise((resolve, reject) => {
        setTimeout(() => resolve('ğŸ“'), 1000);
    });
const getEgg = hen =>
    new Promise((resolve, reject) => {
        setTimeout(() => resolve(`${hen} => ğŸ¥š`), 1000);
    });
const cook = egg =>
    new Promise((resolve, reject) => {
        setTimeout(() => resolve(`${egg} => ğŸ³`), 1000);
    });

getHen()
.then(getEgg)  // .then(hen => getEgg(hen))
.then(cook)  // .then(egg => cook(egg))
.then(console.log);  // .then(meal => console.log(meal));
```

<br><br>

### Error Handling Example

```javascript
const getHen = () => 
    new Promise((resolve, reject) => {
        setTimeout(() => resolve('ğŸ“'), 1000);
    });
const getEgg = hen =>
    new Promise((resolve, reject) => {
        setTimeout(() => reject(new Error(`${hen} => ğŸ¥š`), 1000));
    });
const cook = egg =>
    new Promise((resolve, reject) => {
        setTimeout(() => resolve(`${egg} => ğŸ³`), 1000);
    });

getHen()
.then(getEgg)
.catch(error => {
    return 'ğŸ¥–';
})
.then(cook)
.then(console.log)
.catch(console.log);
```

<br><br>

### Callback chain to promise

#### Callback chain

```javascript
class UserStorage {
    loginUser(id, password, onSuccess, onError) {
        setTimeout(() => {
            if (
                (id === 'bruce' && password === 'dev') ||
                (id === 'bruce2' && password === 'dev2')
            ) {
                onSuccess(id);
            } else {
                onError(new Error('not found'));
            }
        }, 2000);
    }
    getRoles(user, onSuccess, onError) {
        setTimeout(() => {
            if (user === 'bruce') {
                onSuccess({name: 'bruce', role: 'admin'});
            } else {
                onError(new Error('no access'));
            }
        }, 1000);
    }
}


const userStorage = new UserStorage();
const id = prompt('Enter your id');
const password = prompt('Enter your password');

userStorage.loginUser(
    id,
    password,
    (user) => {
        userStorage.getRoles(
            user,
            userWithRole => {
                alert(`Hello ${userWithRole.name}, you have a ${userWithRole.role} role.`);
            },
            error => {
                console.log(error);
            },
        );
    },
    error => {
        console.log(error);
    }
);
```

<br>

#### to promise

```javascript
class UserStorage {
    loginUser(id, password) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if (
                    (id === 'bruce' && password === 'dev') ||
                    (id === 'bruce2' && password === 'dev2')
                ) {
                    resolve(id);
                } else {
                    reject(new Error('not found'));
                }
            }, 2000);
        });
    }

    getRoles(user) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if (user === 'bruce') {
                    resolve({name: 'bruce', role: 'admin'});
                } else {
                    reject(new Error('no access'));
                }
            }, 1000);
        });
    }
}


const userStorage = new UserStorage();
const id = prompt('Enter your id');
const password = prompt('Enter your password');

userStorage.loginUser(id, password)
.then(userStorage.getRoles)
.then(user => alert(`Hello ${user.name}, you have a ${user.role} role.`))
.catch(console.log);
```
